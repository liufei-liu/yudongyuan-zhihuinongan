<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1">
		<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="email=no">
		<meta http-equiv="Expires" content="0">
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-control" content="no-cache">
		<meta http-equiv="Cache" content="no-cache">
		<title>选择产品</title>
		<meta name="keywords" content="">
		<meta name="Description" content="">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" href="css/public.css">
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/city.css">
		<script src="js/jquery.js"></script>

	</head>

	<body>
		<div class="header_box">
			<div class="header">
				<a class="back mui-action-back">
					<img src="images/back.png" alt="">
				</a>
				<h1>选择产品</h1>
				<a class="home ">
					<img src="images/home.png" alt="" />
				</a>
			</div>
		</div>
		<div class="city">
			<div class="city-wrapper city-wrapper-hook">
				<div class="scroller-hook">
					<div class="cities cities-hook"></div>
				</div>
				<div class="shortcut shortcut-hook"></div>
			</div>
		</div>
		<script src="js/bscroll.min.js"></script>
		<script src="../js/mui.min.js"></script>
		<script src="js/init.js"></script>
		<script src="js/public.js"></script>
		<script>
			mui.plusReady(function() {
				var _self = plus.webview.getWebviewById('xuanzechanpin.html');
				var pro_cat2_id = _self.pro_cat2_id;
				
				if(wainshow()==false){return false;};
				$.ajax(www_v+"/pro_registration/catalog_one/", {
					data: {'token': getToken(),'pro_cat2_id': pro_cat2_id},
					type: 'post', //HTTP请求类型
					timeout: 50000, //超时时间设置为10秒；
					success: function(data) {
						check_ajax(data, function(data) {
										//console.log(JSON.stringify(data));
										var cityWrapper = document.querySelector('.city-wrapper-hook');
										var cityScroller = document.querySelector('.scroller-hook');
										var cities = document.querySelector('.cities-hook');
										var shortcut = document.querySelector('.shortcut-hook');
				
										var scroll;
				
										var shortcutList = [];
										var anchorMap = {};
				
										function initCities() {
											var y = 0;
											var titleHeight = 28;
											var itemHeight = 44;
				
											var lists = '';
											var en = '<ul>';
											data.forEach(function(group) {
												var word = group.word;
												lists += '<div class="title">' + word + '</div>';
												lists += '<ul>';
												group.catalog.forEach(function(g) {
													lists += '<li class="item" data-name="' + g.pro_catalog_name + '" data-id="' + g.pro_catalog_id + '"><a href="dengjixinxi.html" data-wid="dengjixinxi.html" data-extras=\'{"pro_cat2_id":"' + pro_cat2_id + '","pro_catalog_id":"' + g.pro_catalog_id + '","pro_catalog_name":"'+g.pro_catalog_name+'"}\'><span class="border-1px name">' + g.pro_catalog_name + '</span></a></li>';
												});
												lists += '</ul>';
				
												var name = group.word.substr(0, 1);
												en += '<li data-anchor="' + name + '" class="item">' + name + '</li>';
												var len = group.catalog.length;
												anchorMap[name] = y;
												y -= titleHeight + len * itemHeight;
				
											});
											en += '</ul>';
											cities.innerHTML = lists;
				
											shortcut.innerHTML = en;
											shortcut.style.top = (cityWrapper.clientHeight - shortcut.clientHeight) / 2 + 'px';
				
											scroll = new window.BScroll(cityWrapper, {
												probeType: 3,
												click: true
											});
										}
				
										//bind Event
										function bindEvent() {
											var touch = {};
											var firstTouch;
				
											shortcut.addEventListener('touchstart', function(e) {
												e.preventDefault();
												e.stopPropagation();
												var anchor = e.target.getAttribute('data-anchor');
				
												firstTouch = e.touches[0];
												touch.y1 = firstTouch.pageY;
												touch.anchor = anchor;
				
												scrollTo(anchor);
				
											});
				
											shortcut.addEventListener('touchmove', function(e) {
				
												firstTouch = e.touches[0];
												touch.y2 = firstTouch.pageY;
				
												var anchorHeight = 16;
				
												var delta = (touch.y2 - touch.y1) / anchorHeight | 0;
				
												var anchor = shortcutList[shortcutList.indexOf(touch.anchor) + delta];
				
												scrollTo(anchor);
				
												e.preventDefault();
												e.stopPropagation();
				
											});
				
											function scrollTo(anchor) {
												var maxScrollY = cityWrapper.clientHeight - cityScroller.clientHeight;
				
												var y = Math.min(0, Math.max(maxScrollY, anchorMap[anchor]));
				
												if(typeof y !== 'undefined') {
													scroll.scrollTo(0, y);
												}
											}
										}
				
										initCities();
				
										bindEvent();
									})
					},
					error: function(xhr, type, errorThrown, selfs) {
						if(type == "timeout") {
							alert("请求超时");
						} else if(type == "abort") {
							alert("请检查您的网络");
						} else if(type == "error") {
							alert("服务端错误");
						}
					}
				});
				
				
				
				
				


			})
		</script>
	</body>

</html>