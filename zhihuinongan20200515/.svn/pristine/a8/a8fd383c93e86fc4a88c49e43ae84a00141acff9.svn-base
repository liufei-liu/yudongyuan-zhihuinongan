<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1">
		<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="email=no">
		<meta http-equiv="Expires" content="0">
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-control" content="no-cache">
		<meta http-equiv="Cache" content="no-cache">
		<title>二维码</title>
		<meta name="keywords" content="">
		<meta name="Description" content="">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" href="css/public.css">
		<link rel="stylesheet" href="css/main.css">
		<script src="js/jquery.js"></script>
		<style type="text/css">
			.tip {
				text-align: left;
				font-size: 16px;
				margin: 0;
				color: #FF9C3C;
				padding: 0.2rem;
			}

			.record_list_ewm {}

			.record_list_ewm>li>a>div {
				padding-left: 0;
				overflow: hidden;
				height: 1.72rem;
			}

			.record_list_ewm>li>a>div>p {
				float: left;
			}

			.record_list_ewm>li>a>div>p:first-child {
				width: 100%;
			}
		</style>
		<style>
			html,
			body {
				background-color: #efeff4;
			}

			.mui-bar~.mui-content .mui-fullscreen {
				top: 44px;
				height: auto;
			}

			.mui-pull-top-tips {
				position: absolute;
				top: -20px;
				left: 50%;
				margin-left: -25px;
				width: 40px;
				height: 40px;
				border-radius: 100%;
				z-index: 1;
			}

			.mui-bar~.mui-pull-top-tips {
				top: 24px;
			}

			.mui-pull-top-wrapper {
				width: 42px;
				height: 42px;
				display: block;
				text-align: center;
				background-color: #efeff4;
				border: 1px solid #ddd;
				border-radius: 25px;
				background-clip: padding-box;
				box-shadow: 0 4px 10px #bbb;
				overflow: hidden;
			}

			.mui-pull-top-tips.mui-transitioning {
				-webkit-transition-duration: 200ms;
				transition-duration: 200ms;
			}

			.mui-pull-top-tips .mui-pull-loading {
				margin: 0;
			}

			.mui-pull-top-wrapper .mui-icon,
			.mui-pull-top-wrapper .mui-spinner {
				margin-top: 7px;
			}

			.mui-pull-bottom-tips {
				text-align: center;
				background-color: #efeff4;
				font-size: 15px;
				line-height: 40px;
				color: #777;
			}

			.mui-pull-top-canvas {
				overflow: hidden;
				background-color: #fafafa;
				border-radius: 40px;
				box-shadow: 0 4px 10px #bbb;
				width: 40px;
				height: 40px;
				margin: 0 auto;
			}

			.mui-pull-top-canvas canvas {
				width: 40px;
			}

			.mui-slider-indicator.mui-segmented-control {
				background-color: #efeff4;
			}
		</style>
	</head>

	<body style="background-color:#fff;">
		<div class="header_box">
			<div class="header">
				<a class="back mui-action-back">
					<img src="images/back.png" alt="">
				</a>
				<h1>标签打印记录</h1>
				<a class="home ">
					<img src="images/home.png" alt="" />
				</a>
			</div>
		</div>
		<p class="tip">
			请使用电脑登录标签打印平台进行打印
			<br />
			登录地址：http://ewm.jnzhna.com
			<br />
			用户名和密码与智慧农安APP用户名和密码一致
		</p>
		<!-- <div class="submit_btn_box">
			<button class="bozhong_submit">返回</button>
		</div> -->
		<!--<img id="img" src="" alt="" style="width:auto;height:auto;margin:1rem auto;"/>
		
		<div class="submit_btn_box">
				<button class="bozhong_submit">保存至相册</button>
			</div>-->
		<!--记录生产列表-->
		<div id="pullrefresh" style="position: fixed;bottom: 0;width: 100%;left: 0;top: 2.56rem;overflow:auto">
			<ul class="record_list record_list_ewm" value="REGISTRATION_ID" id="record_list">
				<!-- <li>
					<a href="">
						<div>
							<p>批次名称：<span>批次批次20180101-06</span></p>
							<p>标签类型：<span>产品名称</span></p>
							<p>打印数量：<span>产品名称</span></p>
							<p>重量：<span>产品名称</span></p>
							<p>打印时间：<span>2017-12-12 14:14:14</span></p>
						</div>
					</a>
				</li> -->
			</ul>
		</div>

		<script src="../js/mui.min.js"></script>
		<!--<script src="../js/mui.pullToRefresh.js"></script>
		<script src="../js/mui.pullToRefresh.material.js"></script>-->
		<script src="lib/layer/layer.js"></script>
		<script src="js/jquery.form.min.js"></script>
		<script src="js/init.js"></script>
		<script src="js/public.js"></script>
		<script>
			var can_post = true; //是否可以发送数据
			var next = 0;
			var PRO_BATCH_NAME = "";
			var creatLi = function(ishtml, callback) {
				mui.plusReady(function() {
					if (can_post) {
						can_post = false;
						$.ajax(www_v + "/label_manage/printlistlabel", {
							data: {
								"token": getToken(),
								"PAGE_NUM": next++,
								"EN_USER_ID": getState().en_user_id,
								"ENTERPRISE_ID": getState().enterprise_id,
								PRO_BATCH_NAME: PRO_BATCH_NAME
							},
							type: 'post',
							timeout: 50000,
							success: function(data) {
								check_ajax(data, function(data) {
									console.log(JSON.stringify(data[0]))
									var ul = mui('.record_list');
									if (data == "") {
										can_post = false;
										mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
										if (ishtml) {
											$(ul).html('');
										}
									} else {
										for (var i = 0, str = ""; i < data.length; i++) {
											str += ' <li>' +
												'<a data-spec="true">' +
												'<div>' +
												'<p>批次名称：<span>' + data[i].pro_batch_name + '</span></p>' +
												'<p style="width:40%">标签类型：<span>' + data[i].print_type + '</span></p>' +
												'<p style="width:60%">打印数量：<span>' + data[i].apply_num + '张</span></p>' +
												'<p style="width:40%">重量：<span>' + (data[i].weight || 0) + (data[i].unit || '千克') + '</span></p>' +
												'<p style="width:60%">打印时间：<span>' + data[i].create_time + '</span></p>' +
												'</div>' +
												'</a>' +
												'</li>';
										}
										if (ishtml) {
											$(ul).html(str);
										} else {
											$(ul).append(str);
										}
										mui('#pullrefresh').pullRefresh().endPullupToRefresh(false);
										mui('#pullrefresh').pullRefresh().enablePullupToRefresh();
										can_post = true;
									}
									if (callback) {
										callback()
									}
								})
							},
							error: function(xhr, type, errorThrown) {
								setTimeout(function() {
									mui("#pullrefresh").pullToRefresh().endPullUpToRefresh(false);
								}, 500)
								ajaxerr(arguments)
							}
						});
					} else {
						mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
					}
				})

			}
			var upAjax = function() {
				creatLi()
			}
			mui.init({
				gestureConfig: {
					// longtap: true, //默认为false
					release: true
				},
				pullRefresh: {
					container: "#pullrefresh", //下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
					up: {
						contentrefresh: '正在加载...',
						contentnomore: '没有更多数据了',
						callback: upAjax,
						auto: true,
						height: 50
					}
				}
			});
			// mui.init();
			// mui.plusReady(function() {
			// $(".bozhong_submit").on("tap", function() {
			// 	mui.back();
			// })
			//				var _self = plus.webview.currentWebview();
			//				var url=_self._img;
			//				$("#img").attr("src",www+url);
			//				$(".bozhong_submit").on("tap",function(){
			//						imgSrc = www+"/"+url;
			//			             var imgDtask = plus.downloader.createDownload(imgSrc, {method: "GET"}, function (d, status) {
			//		                    if (status == 200) {
			//		                        plus.gallery.save(d.filename, function () {
			//		                            plus.io.resolveLocalFileSystemURL(d.filename, function (entry) {
			//		                                entry.remove();
			//		                            });
			//		                            return plus.nativeUI.toast('图片已保存至相册');
			//		                        });
			//		                    } else {
			//		                        alert("保存失败!" + status);
			//		                    }
			//		                });
			//              		imgDtask.start();//开始下载任务
			//				})
			// })
		</script>
	</body>

</html>
