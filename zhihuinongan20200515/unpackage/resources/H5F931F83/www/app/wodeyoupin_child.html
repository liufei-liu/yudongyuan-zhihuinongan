<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1">
		<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="email=no">
		<meta http-equiv="Expires" content="0">
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-control" content="no-cache">
		<meta http-equiv="Cache" content="no-cache">
		<title>我的优品</title>
		<meta name="keywords" content="">
		<meta name="Description" content="">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" href="css/public.css">
		<link rel="stylesheet" href="css/main.css">
		<script src="js/jquery.js"></script>
		<style>
			.tip {
				padding: 0.3rem 0.2rem 0;
				color: #FF9C3C;
			}

			.youpin_submit {
				position: relative;
				top: 0;
				border-bottom: 0;
				margin-top: 0.4rem;
				display: none;
			}

			.youpin_submit.disabled>a {
				background-color: #999;
			}
		</style>
	</head>

	<body style="background-color:#fff;">
		<div class="header_box">
			<div class="header">
				<a class="back mui-action-back">
					<img src="images/back.png" alt="">
				</a>
				<h1>我的优品</h1>
				<a class="home ">
					<img src="images/home.png" alt="" />
				</a>
			</div>
		</div>
		<div id="form_info" action="" method="post" class="register_list">
			<ul>
				<li>
					<span>批次名称：</span>
					<div>
						<span class="pro_batch_name"></span>
						<div>
							<span class=""></span>
						</div>
					</div>
				</li>
				<li>
					<span>优品名称：</span>
					<a href="youpinmingcheng.html">
						<span></span>
						<div>
							<span class="input_tip_more"></span>
						</div>
					</a>
				</li>
				<li>
					<span>优品图片：</span>
					<a href="youpintupian.html">
						<span></span>
						<div>
							<span class="input_tip_more"></span>
						</div>
					</a>
				</li>
				<li>
					<span>店铺链接：</span>
					<a href="dianpulianjie.html">
						<span></span>
						<div>
							<span class="input_tip_more"></span>
						</div>
					</a>
				</li>
				<li>
					<span>溯源详情：</span>
					<a id="zhuisuxiangqing" href="javascript:;" data-spec="ture">
						<span></span>
						<div>
							<span class="input_tip_more"></span>
						</div>
					</a>
				</li>
			</ul>
		</div>
		<div class="tip">
			提示：
			<br>
			1.申请优品前，请将上方产品名称、产品图片、店铺链接填写完整，如信息不完整将影响审核结果！
			<br>
			2.点击下方按钮进行优品申请。
		</div>
		<div style="height: 1.12rem;">
			<div class="good_apply youpin_submit">
				<a href=":;" data-spec="true">优品申请</a>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="js/jquery.form.min.js"></script>
		<script src="js/init.js"></script>
		<script src="js/public.js"></script>
		<script>
			mui.init({
				gestureConfig: {
					longtap: true, //默认为false
					release: true
				}
			});
			mui.plusReady(function() {
				var _self = plus.webview.currentWebview();
				var REGISTRATION_ID = _self.registration_id;
				var PRO_BATCH_NAME = _self.pro_batch_name;
				var PRO_CAT1_ID = _self.pro_cat1_id;
				var PRO_CATALOG_ID = _self.pro_catalog_id;
				var IF_P = _self.if_p;
				switch (IF_P) {
					case '1':
						// 未认证
						$('.tip').html('提示：<br/>' +
							'1.申请优品前，请将上方产品名称、产品图片、店铺链接填写完整，如信息不完整将影响审核结果！<br/>' +
							'2.点击下方按钮进行优品申请。');
						$('.youpin_submit').show()
						break;
					case '2':
						// 认证成功
						$('.tip').html('提示：<br/>' +
							'该产品已通过优品申请，请将上方产品名称、产品图片、店铺链接填写完整，如信息不完整将影响产品售卖！');
						$('.youpin_submit').addClass('disabled').show();
						break;
					case '3':
						// 审核中
						$('.tip').html('提示：<br/>' +
							'1.该产品以提交优品申请，正在审核中，请耐心等待。<br/>' +
							'2.如上方产品名称、产品图片、店铺信息不完整，请及时完善信息。');
						$('.youpin_submit').addClass('disabled').show();
						break;
					case '4':
						// 认证失败
						$('.tip').html('提示：<br/>' +
							'1.申请优品前，请将上方产品名称、产品图片、店铺链接填写完整，如信息不完整将影响审核结果！<br/>' +
							'2.点击下方按钮进行优品申请。');
						$('.youpin_submit').show()
						break;

				}
				$('.youpin_submit').show()
				$(".pro_batch_name").html(PRO_BATCH_NAME);
				mui("body").on("tap", "#zhuisuxiangqing", function() {
					if (unsafe_tap2()) return; // 调用代码
					var webview_style = {
						popGesture: "hide"
					};
					var extras = {
						"PRO_BATCH_NAME": PRO_BATCH_NAME,
						"REGISTRATION_ID": REGISTRATION_ID,
						"PRO_CAT1_ID": PRO_CAT1_ID,
						"PRO_CATALOG_ID": PRO_CATALOG_ID
					};
					var href = "zhuisuxiangqing_" + PRO_CAT1_ID + ".html";
					var id = "zhuisuxiangqing_" + PRO_CAT1_ID + ".html";
					var old_id = plus.webview.getWebviewById(id);
					if (old_id) {
						old_id.close("none", 0);
					}
					var webview = plus.webview.create(href, id, webview_style, extras);
					webview.addEventListener("titleUpdate", function() {
						setTimeout(function() {
							webview.show('pop-in', 300);
						}, 100);
					});
				})
				// 同步数据
				$.ajax(www_v + "/quality/registration_add_product", {
					data: {
						"REGISTRATION_ID": REGISTRATION_ID,
						"token": getToken()
					},
					type: 'post', //HTTP请求类型
					timeout: 50000, //超时时间设置为10秒；
					success: function(data) {
						check_ajax(data, function(data) {
							// console.log(data);
						})
					},
					error: function(xhr, type, errorThrown, selfs) {
						if (type == "timeout") {
							alert("请求超时");
						} else if (type == "abort") {
							alert("请检查您的网络");
						} else if (type == "error") {
							alert("服务端错误");
						}
					}
				});
				mui("body").on("tap", ".youpin_submit>a", function() {
					$.ajax(www_v + "/quality/ifquality", {
						data: {
							"token": getToken(),
							"REGISTRATION_ID": REGISTRATION_ID
						},
						type: 'post', //HTTP请求类型
						timeout: 50000, //超时时间设置为10秒；
						success: function(data) {
							check_ajax(data, function(data) {
								plus.nativeUI.toast("进入人工审核");
								$('.youpin_submit').addClass('disabled').show();
								var list = plus.webview.getWebviewById('wodeyoupin.html');
								mui.fire(list, 'refresh');
							})
						},
						error: function(xhr, type, errorThrown, selfs) {
							if (type == "timeout") {
								alert("请求超时");
							} else if (type == "abort") {
								alert("请检查您的网络");
							} else if (type == "error") {
								alert("服务端错误");
							}
						}
					});

				})
			})
		</script>
	</body>

</html>
