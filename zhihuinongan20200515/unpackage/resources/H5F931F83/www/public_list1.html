<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1">
		<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="email=no">
		<meta http-equiv="Expires" content="0">
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-control" content="no-cache">
		<meta http-equiv="Cache" content="no-cache">
		<title></title>
		<meta name="keywords" content="">
		<meta name="Description" content="">
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="app/css/style.css">
		<link rel="stylesheet" href="app/css/public.css">
		<link rel="stylesheet" href="app/css/reset.css">
		<link rel="stylesheet" href="app/css/city.css">
		<link rel="stylesheet" href="app/css/main.css">
		<script src="app/js/jquery.js"></script>

	</head>

	<body>
		<div class="header_box">
			<div class="header">
				<a class="back mui-action-back">
					<img src="app/images/back.png" alt="">
				</a>
				<h1 class="title"></h1>
				<a class="home ">
					<img src="app/images/home.png" alt="" />
				</a>
			</div>
		</div>
		<div class="city">
			<div class="city-wrapper city-wrapper-hook" style="padding-bottom:1rem;">
				<div class="scroller-hook">
					<div class="cities cities-hook"></div>
				</div>
				<div class="shortcut shortcut-hook"></div>
				
			</div>
		</div>
		<script src="app/js/bscroll.min.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="app/js/init.js"></script>
		<script src="app/js/public.js"></script>
		<script>
			mui.plusReady(function() {	
				window.addEventListener('refresh', function(e) {
					mui.back();
				})
				var self = plus.webview.currentWebview();
				var OPTION_TYPE=self.OPTION_TYPE;
				var OPTION_NAME=self.OPTION_NAME;
				var URL=self.URL;
				var undefined_t=setTimeout(function(){
					if(!OPTION_NAME){
						plus.nativeUI.toast('请重试')
						clearTimeout(undefined_t)
						mui.back();
					}
				},500)
				$("h1.title").html(OPTION_NAME);
				if(wainshow()==false){return false;};
				$.ajax(www_v+"/option/optionlist", {
					data: {'OPTION_TYPE': OPTION_TYPE,'OPTION_NAME': OPTION_NAME,'token': getToken(),"ENTERPRISE_ID":getState().enterprise_id,'EN_USER_ID':getState().en_user_id},
					type: 'post', //HTTP请求类型
					timeout: 50000, //超时时间设置为10秒；
					success: function(data) {
						check_ajax(data, function(data) {
							//console.log(JSON.stringify(data));
							var cityWrapper = document.querySelector('.city-wrapper-hook');
							var cityScroller = document.querySelector('.scroller-hook');
							var cities = document.querySelector('.cities-hook');
							var shortcut = document.querySelector('.shortcut-hook');
	
							var scroll;
	
							var shortcutList = [];
							var anchorMap = {};
	
							function initCities() {
								var y = 0;
								var titleHeight = 28;
								var itemHeight = 44;
	
								var lists = '';
								var en = '<ul>';
								if(data!=""){
									data.forEach(function(group) {
									var word = group.WORD;
									lists += '<div class="title">' + word + '</div>';
									lists += '<ul>';
									group.OPTION.forEach(function(g) {
										lists += '<li class="item" value="'+g.OPTION_ID+'"><a href="javascript:;"><span class="border-1px name">' + g.OPTION_NAME + '</span></a></li>';
									});
									lists += '</ul>';
	
									var name = group.WORD.substr(0, 1);
									en += '<li data-anchor="' + name + '" class="item">' + name + '</li>';
									var len = group.OPTION.length;
									anchorMap[name] = y;
									y -= titleHeight + len * itemHeight;
	
								});
								}
								en += '</ul>';
								lists+='<div class="submit_btn_box">'+
									'<a data-extras=\'{"OPTION_NAME":"'+OPTION_NAME+'","OPTION_TYPE":"'+OPTION_TYPE+'","URL":"'+URL+'"}\' href="public_list1_add.html" data-wid="public_list1_add.html" class="bozhong_submit ">添加'+OPTION_NAME+'</a>'+
								'</div>';
								cities.innerHTML = lists;
								shortcut.innerHTML = en;
								shortcut.style.top = (cityWrapper.clientHeight - shortcut.clientHeight) / 2 + 'px';
	
								scroll = new window.BScroll(cityWrapper, {
									probeType: 3,
									click: true
								});
							}
	
							//bind Event
							function bindEvent() {
								var touch = {};
								var firstTouch;
	
								shortcut.addEventListener('touchstart', function(e) {
									e.preventDefault();
									e.stopPropagation();
									var anchor = e.target.getAttribute('data-anchor');
	
									firstTouch = e.touches[0];
									touch.y1 = firstTouch.pageY;
									touch.anchor = anchor;
	
									scrollTo(anchor);
	
								});
	
								shortcut.addEventListener('touchmove', function(e) {
	
									firstTouch = e.touches[0];
									touch.y2 = firstTouch.pageY;
	
									var anchorHeight = 16;
	
									var delta = (touch.y2 - touch.y1) / anchorHeight | 0;
	
									var anchor = shortcutList[shortcutList.indexOf(touch.anchor) + delta];
	
									scrollTo(anchor);
	
									e.preventDefault();
									e.stopPropagation();
	
								});
	
								function scrollTo(anchor) {
									var maxScrollY = cityWrapper.clientHeight - cityScroller.clientHeight;
	
									var y = Math.min(0, Math.max(maxScrollY, anchorMap[anchor]));
	
									if(typeof y !== 'undefined') {
										scroll.scrollTo(0, y);
									}
								}
							}
	
							initCities();
	
							bindEvent();
							$("body").on("tap",".item",function(e){
								if(unsafe_tap2()) return; // 调用代码
								var _id=$(this).attr("value");
								var _html=$(this).children().children().html();
								var list = plus.webview.getWebviewById(URL);
								mui.fire(list, 'refresh_recode_name',{"_id":_id,"_html":_html});
								mui.back();
							})
						})
					},
					error: function(xhr, type, errorThrown, selfs) {
						if(type == "timeout") {
							alert("请求超时");
						} else if(type == "abort") {
							alert("请检查您的网络");
						} else if(type == "error") {
							alert("服务端错误");
						}
					}
				});		
			});
		</script>
	</body>

</html>