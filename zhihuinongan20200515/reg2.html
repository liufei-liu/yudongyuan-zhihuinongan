<!DOCTYPE html>
<html class="ui-page-login">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="app/css/style.css">
		<link rel="stylesheet" href="app/css/public.css">
		<link rel="stylesheet" href="app/css/main.css">
		<link href="css/style.css" rel="stylesheet" />
		<script src="app/js/jquery.js"></script>
		<style>
			.area {
				margin: 20px auto 0px auto;
			}
			
			.mui-input-group:first-child {
				margin-top: 20px;
			}
			
			.mui-input-group label {
				width: 30%;
			}
			
			.mui-input-row label~input,
			.mui-input-row label~select,
			.mui-input-row label~textarea {
				width: 70%;
			}
			
			.mui-checkbox input[type=checkbox],
			.mui-radio input[type=radio] {
				top: 6px;
			}
			
			.mui-content-padded {
				margin-top: 25px;
			}
			
			.mui-btn {
				padding: 10px;
			}
			input[type=checkbox], .mui-radio input[type=radio]{
				position: relative;
				top: 0;
				left: 0;
			}
		</style>
	</head>

	<body style="background: #fff;">
		<div class="header_box">
			<div class="header">
				<a class="back mui-action-back">
					<img src="app/images/back.png" alt="">
				</a>
				<h1 style="margin: 0.2rem 0;">注册</h1>
			</div>
		</div>
		<div id="form_info" action="" method="post" class="register_list">
			<ul>
				<li>
					<span>单位名称：</span>
					<div>
						<input id="ENTERPRISE_NAME" type="text"  readonly value="" placeholder="请输入单位名称"/>
						<div>
							<span></span>
						</div>
					</div>
				</li>
				<li>
					<span>负&nbsp;&nbsp;责&nbsp;&nbsp;人：</span>
					<div>
						<input id="ENTERPRISE_CHARGE" type="text" readonly value="" placeholder="请输入单位负责人姓名"/>
						<div>
							<span></span>
						</div>
					</div>
				</li>
				
				
				<li>
					<span>手&nbsp;&nbsp;机&nbsp;&nbsp;号：</span>
					<div>
						<input id="EN_USER_MOBILE" type="tel" maxlength="11"  placeholder="请输入手机号" min="0.0" step="0.01">
						<a class="mui-btn" href="javascript:;" id="check_phone">验证</a>
					</div>
				</li>
				<li>
					<span>密&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;码：</span>
					<div>
						<input id="EN_USER_PWD" type="password" placeholder="请输入密码"/>
						<div>
							<span></span>
						</div>
					</div>
				</li>
				<li>
					<span>确认密码：</span>
					<div>
						<input id="RE_EN_USER_PWD" type="password" placeholder="请确认密码"/>
						<div>
							<span></span>
						</div>
					</div>
				</li>
				<li>
					<span>验&nbsp;&nbsp;证&nbsp;&nbsp;码：</span>
					<div>
						<input id="USER_MOBILE_CODE" type="number" placeholder="请输入手机验证码" min="0.0" step="0.01"/>
						<div>
							<span></span>
						</div>
					</div>
				</li>
			</ul>
			<div class="mui-input-group" style="border-top: 5px solid #eee;border-bottom: 5px solid #eee;">
				<div class="mui-input-row mui-radio">
					<label for="radio1" style="width: 100%;position: absolute;top: 0;left:0;">农业生产企业</label>
					<input id="radio1" name="EN_USER_TYPE" value="1" type="radio" checked>
				</div> 
				<div class="mui-input-row mui-radio">
					<label for="radio2" style="width: 100%;position: absolute;top: 0;left:0;">农资</label>
					<input id="radio2" name="EN_USER_TYPE" value="2" type="radio">
				</div> 
			</div>
				<div class="submit_btn_box">
				<a id='reg' href="javascript:;" data-spec="ture" class="bozhong_submit">注册</a>
			</div>
			
		</div>

		<script src="js/mui.min.js"></script>
		<script src="js/md5.js"></script>
		<script src="app/js/init.js"></script>
		<script src="app/js/public.js"></script>
		<script src="js/app.js"></script>
		<script>
			mui.init();
			mui.plusReady(function() {
				/*提交表单的返回*/
				var can_back=true;
				$("body").on("keyup",function(){
					can_back=false;
				})
			 	var old_back=mui.back;
				mui.back=function(){
					if(can_back){
						old_back();
					}else{
						var btnArray = ['否', '是'];
		                mui.confirm('确认要返回么，确认？', TITLE, btnArray, function(e) {
		                    if (e.index == 1) {
		                        old_back();
		                    }
		                })
					}	
				}
//				$("#EN_USER_MOBILE").on("focus",function(){
//					$("#check_phone").hide();
//				})
//				$("#EN_USER_MOBILE").on("blur",function(){
//					$("#check_phone").show();
//				})
				var self = plus.webview.currentWebview();
				var ENTERPRISE_NAME=self.ENTERPRISE_NAME;
				var ENTERPRISE_CHARGE=self.ENTERPRISE_CHARGE;
				var ENTERPRISE_ID=self.ENTERPRISE_ID;
				
				$("#ENTERPRISE_NAME").val(ENTERPRISE_NAME);
				$("#ENTERPRISE_CHARGE").val(ENTERPRISE_CHARGE);
				
				//发送验证码;
				var time;
				mui('body').on('tap', '#check_phone',function(){
					var _this=this;
					if(unsafe_tap2()) return; // 调用代码
					
					var phone=$("#EN_USER_MOBILE").val();
					if (/^1[3|4|5|7|8][0-9]{9}$/.test($("#EN_USER_MOBILE").val())) {
						$(_this).html("60");
						time=setInterval(function(){
							var html=$("#check_phone").html();
							if(html<=0){
								$("#check_phone").html("验证").removeClass("mui-disabled");
								clearInterval(time);
							}else{
								$("#check_phone").html(html-1).addClass("mui-disabled");
							}
							
						},1000);
						$.ajax(www_v+"/login/send_phone_code", {
							data: {"EN_USER_MOBILE":$("#EN_USER_MOBILE").val(),"ENTERPRISE_NAME":$("#ENTERPRISE_NAME").val(),"ENTERPRISE_CHARGE":$("#ENTERPRISE_CHARGE").val()},
							type: 'post', //HTTP请求类型
							timeout: 50000, //超时时间设置为10秒；
							//dataType:"json",
							success: function(data) {
								check_ajax(data,function(data){
									alert(JSON.stringify(data))
									if(data.Message=="OK"){
										 plus.nativeUI.toast('短信已发送');
									}else{
										plus.nativeUI.toast('操作过于频繁,请稍后再试！');
									}
								})
							},
							error: function(xhr, type, errorThrown, selfs) {
								if(type == "timeout") {
									alert("请求超时");
								} else if(type == "abort") {
									alert("请检查您的网络");
								} else if(type == "error") {
									alert("服务端错误");
								}
							}
						});
					}else{
						  plus.nativeUI.toast('手机号格式不正确');
					}

				})
				//提交
				mui('body').on('tap', '#reg', function() {
						if(unsafe_tap2()) return; // 调用代码
					//ENTERPRISE_ID;
					//ENTERPRISE_CHARGE;
					var EN_USER_TYPE=$("input[name='EN_USER_TYPE']:checked").val();//农资还是企业
					var USER_MOBILE_CODE=$("#USER_MOBILE_CODE").val();//验证码
					var EN_USER_PWD=$("#EN_USER_PWD").val();//密码
					var RE_EN_USER_PWD=$("#RE_EN_USER_PWD").val();//确认密码   后台不需要
					var EN_USER_MOBILE=$("#EN_USER_MOBILE").val();//手机号
					//手机号
					function a1(){
												
						if(!/[\S]+/.test(EN_USER_MOBILE)) {
				            plus.nativeUI.toast('手机号不能为空');
				             return false;
				        }else{
				        	return true;
				        }
					}
					//密码
					function a2(){
											
						if(!/[\S]+/.test(EN_USER_PWD)) {
				            plus.nativeUI.toast('密码不能为空');
				             return false;
				        }else if(EN_USER_PWD.length<5){
				         	plus.nativeUI.toast('密码最短为 5 个字符');
				        }else{
				        	return true;
				        }
					}
					//确认密码
					function a3(){
											
						if(RE_EN_USER_PWD!=EN_USER_PWD) {
				            plus.nativeUI.toast('密码两次输入不一致');
				             return false;
				        }else{
				        	return true;
				        }
					}
					//验证码
					function a4(){
											
						if(!/[\S]+/.test(USER_MOBILE_CODE)) {
				            plus.nativeUI.toast('验证码不能为空');
				             return false;
				        }else{
				        	return true;
				        }
					}
					//console.log(a1()&&a2()&&a3()&&a4());
					if(a1()&&a2()&&a3()&&a4()){
						var datas={ "ENTERPRISE_ID":ENTERPRISE_ID,
									"ENTERPRISE_CHARGE":ENTERPRISE_CHARGE,
									"EN_USER_TYPE":EN_USER_TYPE,
									"USER_MOBILE_CODE":USER_MOBILE_CODE,
									"EN_USER_PWD":hex_md5(EN_USER_PWD),
									"EN_USER_MOBILE":EN_USER_MOBILE
								};
						
						if(wainshow()==false){return false;};
						$.ajax(www_v+"/login/register", {
							data: datas,
							type: 'post', //HTTP请求类型
							timeout: 50000, //超时时间设置为10秒；
							success: function(data) {
								check_ajax(data,function(data){
								plus.nativeUI.toast('注册成功');
								mui.openWindow({
									url: 'login.html',
									id: 'login.html',
									show: {
										aniShow: 'pop-in'
									}
								});
							})
							},
							error: function(xhr, type, errorThrown, selfs) {
								if(type == "timeout") {
									alert("请求超时");
								} else if(type == "abort") {
									alert("请检查您的网络");
								} else if(type == "error") {
									alert("服务端错误");
								}
							}
						});
					}

				})

			})
			
			
			
			
			
			
			
//			(function($, doc) {
//				$.init();
//				$.plusReady(function() {
//					
//					
//					var settings = app.getSettings();
//					var regButton = doc.getElementById('reg');
//					var accountBox = doc.getElementById('account');
//					var passwordBox = doc.getElementById('password');
//					var passwordConfirmBox = doc.getElementById('password_confirm');
//					var emailBox = doc.getElementById('email');
//					regButton.addEventListener('tap', function(event) {
//						var regInfo = {
//							account: accountBox.value,
//							password: passwordBox.value,
//							email: emailBox.value
//						};
//						var passwordConfirm = passwordConfirmBox.value;
//						if(passwordConfirm != regInfo.password) {
//							plus.nativeUI.toast('密码两次输入不一致');
//							return;
//						}
//						app.reg(regInfo, function(err) {
//							if(err) {
//								plus.nativeUI.toast(err);
//								return;
//							}
//							plus.nativeUI.toast('注册成功');
//							plus.webview.getLaunchWebview().show("pop-in", 200, function() {
//								plus.webview.currentWebview().close("none");
//							});
//							//若启动页不是登录页，则需通过如下方式打开登录页
//							//							$.openWindow({
//							//								url: 'login.html',
//							//								id: 'login',
//							//								show: {
//							//									aniShow: 'pop-in'
//							//								}
//							//							});
//						});
//					});
//				});
//			}(mui, document));
		</script>
	</body>

</html>