<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>忘记密码</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="app/css/style.css">
		<link rel="stylesheet" href="app/css/public.css">
		<link rel="stylesheet" href="app/css/main.css">
		<script src="app/js/jquery.js"></script>
	</head>

	<body style="background-color:#fff">
		<div class="header_box">
			<div class="header">
				<a class="back mui-action-back">
					<img src="app/images/newImgs/newback.png" alt="">
				</a>
				<h1>忘记密码</h1>
			</div>
		</div>
		<div id="form_info" action="" method="post" class="register_list register_list_long">
			<ul>
				<li>
					<span>&nbsp;手&nbsp;机&nbsp;号&nbsp;：</span>
					<div>
						<input type="tel" maxlength="11" id="EN_USER_MOBILE"  name="EN_USER_MOBILE" value="" placeholder="请输入手机号" style="padding-right: 0.5rem;" min="0.0" step="0.01"/>
						<a class="mui-btn" href="javascript:;" id="check_phone">验证</a>
					</div>
				</li>
				<li>
					<span>&nbsp;验&nbsp;证&nbsp;码&nbsp;：</span>
					<div>
						<input type="number" id="USER_MOBILE_CODE" name="USER_MOBILE_CODE"  value="" placeholder="请输入手机验证码" min="0.0" step="0.01"/>
						<div>
							<span></span>
						</div>
					</div>
				</li>
				<li>
					<span>&nbsp;新&nbsp;密&nbsp;码&nbsp;：</span>
					<div>
						<input type="password" name="EN_USER_PWD" placeholder="请输入新密码"/>
						<div>
							<span></span>
						</div>
					</div>
				</li>
				<li>
					<span>确认密码：</span>
					<div>
						<input type="password" name="RE_EN_USER_PWD" placeholder="请确认密码"/>
						<div>
							<span></span>
						</div>
					</div>
				</li>
				
			</ul>
			
			<div class="submit_btn_box ">
				<button class="bozhong_submit" id="save">保存</button>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/md5.js"></script>
		<script src="app/js/init.js"></script>
		<script src="app/js/public.js"></script>
		<script>
			mui.init();
			mui.plusReady(function() {
				/*提交表单的返回*/
				var can_back=true;
				$("body").on("keyup",function(){
					can_back=false;
				})
			 	var old_back=mui.back;
				mui.back=function(){
					if(can_back){
						old_back();
					}else{
						var btnArray = ['否', '是'];
		                mui.confirm('确认要返回么，确认？', TITLE, btnArray, function(e) {
		                    if (e.index == 1) {
		                        old_back();
		                    }
		                })
					}	
				}
				var time;
				//发送验证码;
				mui('body').on('tap', '#check_phone',function(){
					if(unsafe_tap2()) return; // 调用代码
					var _this=this;
					var phone=$("#EN_USER_MOBILE").val();
					if (/^1[3|4|5|7|8][0-9]{9}$/.test($("#EN_USER_MOBILE").val())) {
						$(_this).html("60");
						time=setInterval(function(){
							var html=$("#check_phone").html();
							if(html<=0){
								$("#check_phone").html("验证").removeClass("mui-disabled");
								clearInterval(time);
							}else{
								$("#check_phone").html(html-1).addClass("mui-disabled");
							}
							
						},1000);
						if(wainshow()==false){return false;};
						$.ajax(www_v+"/login/send_code_no", {
							data: {"EN_USER_MOBILE":$("#EN_USER_MOBILE").val()},
							type: 'post', //HTTP请求类型
							timeout: 50000, //超时时间设置为10秒；
							success: function(data) {
								//console.log(data);
								check_ajax(data,function(data){
									//console.log(data);
									if(data!=""){
										 plus.nativeUI.toast('短信已发送');
									}
								})
							},
							error: function(xhr, type, errorThrown, selfs) {
								if(type == "timeout") {
									alert("请求超时");
								} else if(type == "abort") {
									alert("请检查您的网络");
								} else if(type == "error") {
									alert("服务端错误");
								}
							}
						});
					}else{
						  plus.nativeUI.toast('手机号格式不正确');
					}
				})
				//提交
				mui('body').on('tap', '#save',function(){
					if(unsafe_tap2()) return; // 调用代码
					
					var EN_USER_MOBILE=$("input[name='EN_USER_MOBILE']").val();
					var USER_MOBILE_CODE=$("input[name='USER_MOBILE_CODE']").val();
					var EN_USER_PWD=$("input[name='EN_USER_PWD']").val();
					var RE_EN_USER_PWD=$("input[name='RE_EN_USER_PWD']").val();
					//手机号
					function a1(){						
						if(!/[\S]+/.test(EN_USER_MOBILE)) {
				            plus.nativeUI.toast('手机号不能为空');
				             return false;
				        }else{
				        	return true;
				        }
					}
					//验证码
					function a4(){				
						if(!/[\S]+/.test(USER_MOBILE_CODE)) {
				            plus.nativeUI.toast('验证码不能为空');
				             return false;
				        }else{
				        	return true;
				        }
					}
					//密码
					function a2(){					
						if(!/[\S]+/.test(EN_USER_PWD)) {
				            plus.nativeUI.toast('密码不能为空');
				             return false;
				        }else if(EN_USER_PWD.length<5){
				         	plus.nativeUI.toast('密码最短为 5 个字符');
				        }else{
				        	return true;
				        }
					}
					//确认密码
					function a3(){				
						if(RE_EN_USER_PWD!=EN_USER_PWD) {
				            plus.nativeUI.toast('密码两次输入不一致');
				             return false;
				        }else{
				        	return true;
				        }
					}
					
					
					if(a1()&&a4()&&a2()&&a3()){
						var datas={ 
							"EN_USER_MOBILE":EN_USER_MOBILE,
							"USER_MOBILE_CODE":USER_MOBILE_CODE,
							"EN_USER_PWD":hex_md5(EN_USER_PWD)
						};	
						if(wainshow()==false){return false;};
						$.ajax(www_v+"/login/update_password/", {
							data: datas,
							type: 'post', //HTTP请求类型
							timeout: 50000, //超时时间设置为10秒；
							success: function(data) {
								check_ajax(data,function(data){
									//console.log(data);
									plus.nativeUI.toast('请登录');
									setState();
									mui.openWindow({
										url: 'login.html',
										id: 'login.html',
										show: {
											aniShow: 'pop-in'
										}
									});
								})
							},
							error: function(xhr, type, errorThrown, selfs) {
								if(type == "timeout") {
									alert("请求超时");
								} else if(type == "abort") {
									alert("请检查您的网络");
								} else if(type == "error") {
									alert("服务端错误");
								}
							}
						});
					}
				})
				
			})
		</script>
	</body>

</html>