<!DOCTYPE html>
<html>
<head>
		<meta charset="utf-8">
		<title>文章</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" href="css/public.css">
		<link rel="stylesheet" href="css/main.css">
		<link rel="stylesheet" href="css/content.css">
		<script src="js/jquery.js"></script>
</head>
<body>
<div class="header_box">
	<div class="header">
		<a class="back mui-action-back">
			<img src="images/newImgs/newback.png" alt="">
		</a>
		<h1>文章</h1>
		<a class="home ">
			<img src="images/newImgs/home.png" alt="" />
		</a>
	</div>
</div>
<div class="content_top">
    <h1></h1>
    <div>
        <span class="pinglun_num"></span>
        <i><span></span></i>
        <b></b>
    </div>
</div>
<div class="content">

</div>
<!--评论-->
<div class="pinglun_box">
    <p>评论<span>(0)</span><a href="leave_word.html" data-spec="ture" class="leave_word" id="leave_word">去评论</a></p>
    <ul>
     
    </ul>
    <a href="article_content.html" data-wid="article_content.html" data-spec="ture" class="hide" id="all_content">查看全部评论</a>
</div>
<script src="../js/mui.min.js"></script>
<script src="js/jquery.form.min.js"></script>
<script src="js/init.js"></script>
<script src="js/public.js"></script>
<script>
	mui.init();
	mui.plusReady(function() {	
		var _self = plus.webview.currentWebview();
		var CONTENT_ID = _self.CONTENT_ID;
		var LABLE_CODE = _self.LABLE_CODE;
		//console.log(CONTENT_ID);
		
		

		
		mui('body').on('tap', '#all_content', function() {
			if(unsafe_tap2()) return; // 调用代码
				var id = this.getAttribute("data-wid");
				if(!id) {
					id = this.getAttribute('href');
				}
				var old_id=plus.webview.getWebviewById(id);
				if(old_id){
					old_id.close("none",0);
				}
				var href = this.getAttribute('href');
				var webview_style = {
					popGesture: "hide "
				}
				var extras = {"CONTENT_ID":CONTENT_ID,"TITLE":$(".content_top h1").html()};
				var webview = plus.webview.create(this.href, id, webview_style, extras);
				webview.addEventListener("titleUpdate", function() {
					setTimeout(function() {
						webview.show('pop-in', 300);
					}, 100);
				});
		})
		mui('body').on('tap', '#leave_word', function() {
			if(unsafe_tap2()) return; // 调用代码
				var webview_style = {
					popGesture: "hide "
				}
				var id='leave_word.html';
				var href='leave_word.html';
				var old_id=plus.webview.getWebviewById(id);
				if(old_id){
					old_id.close("none",0);
				}
				var extras = {"CONTENT_ID":CONTENT_ID,"TITLE":$(".content_top h1").html()};
				var webview = plus.webview.create(href,id, webview_style, extras);
				webview.addEventListener("titleUpdate", function() {
					setTimeout(function() {
						webview.show('pop-in', 300);
					}, 100);
				});
		})
		if(wainshow()==false){return false;};
		$.ajax(www_v+"/content/content", {
			data: {"CONTENT_ID":CONTENT_ID,"token":getToken()},
			type: 'post', //HTTP请求类型
			timeout: 50000, //超时时间设置为10秒；
			success: function(data) {
				check_ajax(data,function(data){
						//console.log(JSON.stringify(data));
						$(".content_top>h1").html(data.TITLE);//标题
						$(".content_top>div>b").html(data.CREATE_TIME.slice(0,10));//时间
						for(var i=0,str="";i<data.LABEL_NAME.length;i++){
							str+='<span class="lable_'+data.LABEL_NAME[i].LABEL_CODE+'">'+data.LABEL_NAME[i].LABEL_NAME+'</span>'
						}
						$(".content_top>div>i").html(str);
		
						//$(".content").html($(".content").text(data.CONTENT).html());
						var new_html=data.CONTENT;
						  new_html=new_html.replace(/(&lt;)/g,'<').replace(/(&gt;)/g,'>').replace(/(&amp;nbsp;)/g,' ');
						$(".content").html(new_html);
						//$(".content").html('<h1 style="font-size:100px;">2</h1>');
					})
			},
			error: function(xhr, type, errorThrown, selfs) {
				if(type == "timeout") {
					alert("请求超时");
				} else if(type == "abort") {
					alert("请检查您的网络");
				} else if(type == "error") {
					alert("服务端错误");
				}
			}
		});
		$.ajax(www_v+"/content/commentlist", {
			data: {"CONTENT_ID":CONTENT_ID,"token":getToken()},
			type: 'post', //HTTP请求类型
			timeout: 50000, //超时时间设置为10秒；
			success: function(data) {
				var datas=JSON.parse(data);
					check_ajax(data,function(data){
						$(".pinglun_num").html(datas.comment_num);//评论数
					
						$(".pinglun_box>p>span").html("("+datas.comment_num+")");
						if(data.length<datas.comment_num){
							$(".pinglun_box>a").removeClass("hide");
						}
						for(var i=0,str="";i<data.length;i++){
							str+=' <li>'+
							            '<div class="one_pinglun">'+
							                '<img src="'+www+data[i].en_user_profile+'" alt="">'+
							                '<div>'+
							                    '<b>'+data[i].en_user_name+'</b>'+
							                '</div>'+
							                '<i>'+data[i].create_time.slice(0,10)+'</i>'+
							                '<p>'+data[i].comment+'</p>'+
							            '</div>'+
							        '</li>';
						}
						$(".pinglun_box>ul").html(str);
						
					})
			},
			error: function(xhr, type, errorThrown, selfs) {
				if(type == "timeout") {
					alert("请求超时");
				} else if(type == "abort") {
					alert("请检查您的网络");
				} else if(type == "error") {
					alert("服务端错误");
				}
			}
		});
		
		
		
	})
</script>
</body>
</html> 